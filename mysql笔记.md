#mysql

国际上的UTF-8，在MySQL中，对标的是uft8mb4。

在MySQL中，实际用utf8mb3。字符集一般用utf8_general_ci。

至于uft8，在 V8.0 还是指代的utf8mb3，未来的会变为uft8mb4。

##主键
对于关系表，有个很重要的约束，就是任意两条记录不能重复。不能重复不是指两条记录不完全相同，而是指能够通过某个字段唯一区分出不同的记录，这个字段被称为主键。

对主键的要求，最关键的一点是：记录一旦插入到表中，主键最好不要再修改，因为主键是用来唯一定位记录的，修改了主键，会造成一系列的影响。

由于主键的作用十分重要，如何选取主键会对业务开发产生重要影响。如果我们以学生的身份证号作为主键，似乎能唯一定位记录。然而，身份证号也是一种业务场景，如果身份证号升位了，或者需要变更，作为主键，不得不修改的时候，就会对业务产生严重影响。手机号也同理主适合作为主键。

所以，选取主键的一个基本原则是：不使用任何业务相关的字段作为主键。
因此，身份证号、手机号、邮箱地址这些看上去可以唯一的字段，均不可用作主键。

作为主键最好是完全业务无关的字段，我们一般把这个字段命名为id。常见的可作为id字段的类型有：

1. 自增整数类型：数据库会在插入数据时自动为每一条记录分配一个自增整数，这样我们就完全不用担心主键重复，也不用自己预先生成主键；
2. 全局唯一GUID类型：使用一种全局唯一的字符串作为主键，类似8f55d96b-8acc-4636-8cb8-76bf8abc2f57。GUID算法通过网卡MAC地址、时间戳和随机数保证任意计算机在任意时间生成的字符串都是不同的，大部分编程语言都内置了GUID算法，可以自己预算出主键。
3. 对于大部分应用来说，通常自增类型的主键就能满足需求。我们在students表中定义的主键也是BIGINT NOT NULL AUTO_INCREMENT类型。

**如果使用INT自增类型，那么当一张表的记录数超过2147483647（约21亿）时，会达到上限而出错。使用BIGINT自增类型则可以最多约922亿亿条记录**

##外键
由于外键约束会降低数据库的性能，大部分互联网应用程序为了追求速度，并不设置外键约束，而是仅靠应用程序自身来保证逻辑的正确性。这种情况下，class_id仅仅是一个普通的列，只是它起到了外键的作用而已。
##索引
索引是关系数据库中对某一列或多个列的值进行预排序的数据结构。通过使用索引，可以让数据库系统不必扫描整个表，而是直接定位到符合条件的记录，这样就大大加快了查询速度。

索引的效率取决于索引列的值是否散列，即该列的值如果越互不相同，那么索引效率越高。反过来，如果记录的列存在大量相同的值，例如gender列，大约一半的记录值是M，另一半是F，因此，对该列创建索引就没有意义。

关注微博获取实时动态：


索引
最后更新: 2018/6/3 07:18 / 阅读: 12719763
在关系数据库中，如果有上万甚至上亿条记录，在查找记录的时候，想要获得非常快的速度，就需要使用索引。

索引是关系数据库中对某一列或多个列的值进行预排序的数据结构。通过使用索引，可以让数据库系统不必扫描整个表，而是直接定位到符合条件的记录，这样就大大加快了查询速度。

例如，对于students表：

id	class_id	name	gender	score
1	1	小明	M	90
2	1	小红	F	95
3	1	小军	M	88
如果要经常根据score列进行查询，就可以对score列创建索引：

ALTER TABLE students
ADD INDEX idx_score (score);
使用ADD INDEX idx_score (score)就创建了一个名称为idx_score，使用列score的索引。索引名称是任意的，索引如果有多列，可以在括号里依次写上，例如：students表

| id   | class_id | name | gender | score |
| ---- |---- |---- |---- |---- |
| 1 |1 |小明 |M |90 |
| 2 |1 |小红 |M |50 |
| 3 |1 |小军 |M |60 |

如果要经常根据score列进行查询，就可以对score列创建索引：

ALTER TABLE students
ADD INDEX idx_name_score (name, score);
索引的效率取决于索引列的值是否散列，即该列的值如果越互不相同，那么索引效率越高。反过来，如果记录的列存在大量相同的值，例如gender列，大约一半的记录值是M，另一半是F，因此，对该列创建索引就没有意义。

可以对一张表创建多个索引。索引的优点是提高了查询效率，缺点是在插入、更新和删除记录时，需要同时修改索引，因此，索引越多，插入、更新和删除记录的速度就越慢。

对于主键，关系数据库会自动对其创建主键索引。使用主键索引的效率是最高的，因为主键会保证绝对唯一。

##事务
把多条语句作为一个整体进行操作的功能，被称为数据库事务。数据库事务可以确保该事务范围内的所有操作都可以全部成功或者全部失败。如果事务失败，那么效果就和没有执行这些SQL一样，不会对数据库数据有任何改动。

数据库事务具有ACID这4个特性：

1. Atomic，原子性，将所有SQL作为原子工作单元执行，要么全部执行，要么全部不执行；
2. Consistent，一致性，事务完成后，所有数据的状态都是一致的，即A账户只要减去了100，B账户则必定加上了100；
3. Isolation，隔离性，如果有多个事务并发执行，每个事务作出的修改必须与其他事务隔离；
4. Duration，持久性，即事务完成后，对数据库数据的修改被持久化存储。

对于单条SQL语句，数据库系统自动将其作为一个事务执行，这种事务被称为隐式事务。

###隔离级别
对于两个并发执行的事务，如果涉及到操作同一条记录的时候，可能会发生问题。因为并发操作会带来数据的不一致性，包括脏读、不可重复读、幻读等。数据库系统提供了隔离级别来让我们有针对性地选择事务的隔离级别，避免数据不一致的问题。

##ORM
对象关系映射（Object Relational Mapping，简称ORM），是一种程序技术，实现面向对象编程语言中的内存对象与关系型数据库中的业务实体之间的关系映射。这样在我们操作数据库的时候，不再需要和复杂的SQL语句打交道，只需要简单地操作对象的属性和方法就可以直接实现对数据库中对应实体表的CRUD（增删改查）的操作。常见的ORM框架有Node.js 的TypeOrm、Sequlize，Java的Hibernate、Mybatis和Go的Gorm、GoRose等。

ORM的方法论基于三个核心原则:

1. 简单：以最基本的形式建模数据.
2. 传达性：数据库结构被任何人都能理解的语言文档化
3. 精确性：基于数据模型创建正确、标准化的结构


##mysql常用命令

###查看当前主机ip
nslookup  localhost

启动MySQL服务 mysql.server start

停止MySQL服务 mysql.server stop

重启MySQL服务 mysql.server restart

###连接数据库 （mysql 命令是忽略大小写的）
mysql -u root -p
然后输入数据库密码
###显示当前存在的数据库
show databases;
###选择你所需要操作的数据库
use beegodb;
###查看当前数据库有哪些表
show tables;
###数据库设置中文编码
set names utf8;

###显示表结构
describe users;

###创建表语法
####eg1
create table users(
id int (11),
username varchar(255), 
age int (3),
sex int(1)
);

####eg2

CREATE TABLE `class`  (
  `id` int(0) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) ,
  `email` varchar(255) ,
  `score` tinyint(0) ,
  PRIMARY KEY (`id`)
)

###查找部分字段
select name,score from class;

###查找分数大于60的学生信息
select * from class where score >= 60;

###左连接 ，右连接，内连接和全外连接的4者区别
1. left join （左连接）：返回包括左表中的所有记录和右表中连接字段相等的记录。
2. right join （右连接）：返回包括右表中的所有记录和左表中连接字段相等的记录。
3. inner join （等值连接或者叫内连接）：只返回两个表中连接字段相等的行。
4. full join （全外连接）：返回左右表中所有的记录和左右表中连接字段相等的记录。
